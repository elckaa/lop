<div class="container py-5 d-flex justify-content-center">

  <div *ngIf="cargando" class="text-center">
    <div class="spinner-border text-primary"></div>
    <p>Cargando ejercicio...</p>
  </div>

  <div *ngIf="!cargando && !juegoTerminado && ejercicioActual" class="card shadow-lg border-0 rounded-4 w-100" style="max-width: 600px;">

    <div class="progress" style="height: 8px;">
      <div class="progress-bar bg-success" role="progressbar"
           [style.width.%]="(indiceActual / ejercicios.length) * 100"></div>
    </div>

    <div class="card-body p-5">

      <span class="badge bg-secondary mb-3">{{ ejercicioActual.tipo }}</span>
      <h3 class="fw-bold mb-4">{{ ejercicioActual.enunciado }}</h3>

      <div *ngIf="ejercicioActual.tipo === 'IMAGEN' && ejercicioActual.contenido" class="text-center mb-4">
        <img [src]="getMedia(ejercicioActual.contenido)" class="img-fluid rounded-3 shadow-sm" style="max-height: 200px;">
      </div>

      <div *ngIf="ejercicioActual.tipo === 'LISTENING' && ejercicioActual.contenido" class="text-center mb-4">
        <audio controls class="w-100">
           <source [src]="getMedia(ejercicioActual.contenido)">
        </audio>
      </div>

      <div *ngIf="['SELECCION_MULTIPLE', 'VERDADERO_FALSO', 'IMAGEN'].includes(ejercicioActual.tipo)" class="d-grid gap-2">
        <button *ngFor="let opt of ejercicioActual.opcionesArray"
                class="btn btn-outline-primary btn-lg text-start"
                (click)="respuestaUsuario = opt; verificarRespuesta()">
          {{ opt }}
        </button>
      </div>

      <div *ngIf="['TRADUCCION', 'LISTENING'].includes(ejercicioActual.tipo)">
        <textarea class="form-control form-control-lg bg-light mb-3" rows="3"
                  [(ngModel)]="respuestaUsuario" placeholder="Escribe tu respuesta aquí..."></textarea>

        <button class="btn btn-success w-100 btn-lg fw-bold" (click)="verificarRespuesta()">
          COMPROBAR
        </button>
      </div>

    </div>

    <div class="card-footer bg-white border-0 text-center pb-4 text-muted small">
      Pregunta {{ indiceActual + 1 }} de {{ ejercicios.length }}
    </div>
  </div>

  <div *ngIf="juegoTerminado" class="card shadow-lg border-0 rounded-4 text-center p-5 animate-slide-in" style="max-width: 500px;">
    <div class="mb-4">
      <i class="bi bi-trophy-fill text-warning" style="font-size: 5rem;"></i>
    </div>

    <h2 class="fw-bold mb-2">¡Lección Completada!</h2>
    <p class="text-muted">Has terminado todos los ejercicios.</p>

    <div class="display-1 fw-bold text-primary my-4">{{ notaFinal }}%</div>

    <p class="mb-4" *ngIf="notaFinal >= 70">¡Excelente trabajo! Has aprobado.</p>
    <p class="mb-4 text-danger" *ngIf="notaFinal < 70">Sigue practicando para mejorar.</p>

    <button class="btn btn-primary btn-lg rounded-pill px-5 fw-bold" (click)="volverAlDashboard()">
      CONTINUAR
    </button>
  </div>

</div>
